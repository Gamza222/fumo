{"file":"/Users/gamzaramazanov/Desktop/fumo/src/infrastructure/providers/app-loading/hooks/useAppLoading/useAppLoading.ts","mappings":"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","names":[],"sources":["/Users/gamzaramazanov/Desktop/fumo/src/infrastructure/providers/app-loading/hooks/useAppLoading/useAppLoading.ts"],"sourcesContent":["/**\n * useAppLoading Hook\n *\n * Manages initial app loading state and progress.\n * Checks multiple conditions in priority order.\n * Provides smooth loading experience with progress tracking.\n */\n\n\"use client\";\n\nimport { useState, useEffect, useCallback, useMemo } from \"react\";\nimport {\n  AppLoadingConditionId,\n  AppLoadingConditionName,\n  AppLoadingPriority,\n} from \"../../model/enums/enums\";\nimport {\n  TIMEOUTS,\n  PRIORITIES,\n  MINIMUM_DISPLAY_TIME,\n  CHECK_INTERVAL,\n  SELECTORS,\n  DOCUMENT_COMPLETE,\n  FADE_OUT_DELAY,\n  DEFAULT_TIMEOUT,\n} from \"../../model/constants/constants\";\nimport {\n  LoadingCondition,\n  LoadingStep,\n  UseAppLoadingReturn,\n} from \"../../model/types/types\";\n\n// ============================================================================\n// CONDITION CHECKS (Single Responsibility - Each checks one thing)\n// ============================================================================\n\n// Check if DOM is fully loaded\nconst checkDOMReady = (): boolean => document.readyState === DOCUMENT_COMPLETE;\n\n// Check if critical CSS files are loaded (with fallback for no critical CSS)\nconst checkCriticalCSS = (): boolean => {\n  const criticalSheets = document.querySelectorAll(SELECTORS.CRITICAL_CSS);\n  return (\n    criticalSheets.length === 0 ||\n    Array.from(criticalSheets).every(\n      (sheet) => (sheet as HTMLLinkElement).sheet !== null\n    )\n  );\n};\n\n// Check if theme is applied to document\nconst checkThemeInitialized = (): boolean => {\n  return (\n    document.documentElement.hasAttribute(SELECTORS.THEME_ATTRIBUTE) ||\n    document.body.classList.contains(SELECTORS.THEME_CLASS) ||\n    document.documentElement.classList.contains(SELECTORS.THEME_APPLIED_CLASS)\n  );\n};\n\n// Check if core JavaScript is ready\nconst checkCoreJavaScript = (): boolean => {\n  return (\n    typeof window !== \"undefined\" && document.readyState === DOCUMENT_COMPLETE\n  );\n};\n\n// Wait for minimum display time (ensures smooth UX even on fast loads)\nconst checkMinimumDisplayTime = (): Promise<boolean> => {\n  return new Promise<boolean>((resolve) => {\n    const startTime = performance.now();\n\n    const checkTime = () => {\n      if (performance.now() - startTime >= MINIMUM_DISPLAY_TIME) {\n        resolve(true);\n      } else {\n        setTimeout(checkTime, CHECK_INTERVAL);\n      }\n    };\n\n    checkTime();\n  });\n};\n\n// ============================================================================\n// CONDITIONS CONFIGURATION (Open/Closed - Easy to extend)\n// ============================================================================\n\n// Creates array of loading conditions with proper configuration\nconst createLoadingConditions = (): LoadingCondition[] => [\n  {\n    id: AppLoadingConditionId.DOM_READY,\n    name: AppLoadingConditionName.PREPARING_APPLICATION,\n    priority: PRIORITIES[AppLoadingConditionId.DOM_READY],\n    check: checkDOMReady,\n    timeout: TIMEOUTS[AppLoadingConditionId.DOM_READY],\n  },\n  {\n    id: AppLoadingConditionId.CRITICAL_CSS,\n    name: AppLoadingConditionName.LOADING_STYLES,\n    priority: PRIORITIES[AppLoadingConditionId.CRITICAL_CSS],\n    check: checkCriticalCSS,\n    timeout: TIMEOUTS[AppLoadingConditionId.CRITICAL_CSS],\n  },\n  {\n    id: AppLoadingConditionId.THEME_INITIALIZED,\n    name: AppLoadingConditionName.APPLYING_THEME,\n    priority: PRIORITIES[AppLoadingConditionId.THEME_INITIALIZED],\n    check: checkThemeInitialized,\n    timeout: TIMEOUTS[AppLoadingConditionId.THEME_INITIALIZED],\n  },\n  {\n    id: AppLoadingConditionId.CORE_JAVASCRIPT,\n    name: AppLoadingConditionName.LOADING_CORE_FEATURES,\n    priority: PRIORITIES[AppLoadingConditionId.CORE_JAVASCRIPT],\n    check: checkCoreJavaScript,\n    timeout: TIMEOUTS[AppLoadingConditionId.CORE_JAVASCRIPT],\n  },\n  {\n    id: AppLoadingConditionId.MINIMUM_DISPLAY_TIME,\n    name: AppLoadingConditionName.FINALIZING_SETUP,\n    priority: PRIORITIES[AppLoadingConditionId.MINIMUM_DISPLAY_TIME],\n    check: checkMinimumDisplayTime,\n    timeout: TIMEOUTS[AppLoadingConditionId.MINIMUM_DISPLAY_TIME],\n  },\n];\n\n// ============================================================================\n// MAIN HOOK (Orchestrates everything)\n// ============================================================================\n\nexport function useAppLoading(): UseAppLoadingReturn {\n  // Loading state: tracks progress, current step, and completion status\n  const [state, setState] = useState({\n    isInitialLoading: true,\n    progress: 0,\n    currentStep: \"\",\n    steps: [] as LoadingStep[],\n    isSuspenseLoading: false,\n  });\n\n  // Memoize conditions to prevent recreation on every render (performance)\n  const loadingConditions = useMemo(() => createLoadingConditions(), []);\n\n  // Main loading logic: checks all conditions in sequence\n  const checkLoadingSteps = useCallback(async () => {\n    // Initialize steps with completion status\n    const stepsWithStatus: LoadingStep[] = loadingConditions.map(\n      (condition) => ({\n        id: condition.id,\n        name: condition.name,\n        completed: false,\n        priority: condition.priority || AppLoadingPriority.LOWEST,\n      })\n    );\n\n    setState((prev) => ({ ...prev, steps: stepsWithStatus }));\n\n    // Check each condition with timeout protection\n    const checkPromises = loadingConditions.map(async (condition, index) => {\n      // Update progress and current step\n      setState((prev) => ({\n        ...prev,\n        currentStep: condition.name,\n        progress: (index / loadingConditions.length) * 100,\n      }));\n\n      try {\n        // Race between condition check and timeout\n        const result = await Promise.race([\n          Promise.resolve(condition.check()),\n          new Promise<boolean>((_, reject) =>\n            setTimeout(\n              () => reject(new Error(\"Timeout\")),\n              condition.timeout || DEFAULT_TIMEOUT\n            )\n          ),\n        ]);\n\n        // Update step completion and progress\n        setState((prev) => ({\n          ...prev,\n          steps: prev.steps.map((step) =>\n            step.id === condition.id ? { ...step, completed: result } : step\n          ),\n          progress: ((index + 1) / loadingConditions.length) * 100,\n        }));\n\n        return result;\n      } catch (error) {\n        // Graceful degradation: mark as completed on error\n        console.warn(`Loading condition \"${condition.name}\" failed:`, error);\n        setState((prev) => ({\n          ...prev,\n          steps: prev.steps.map((step) =>\n            step.id === condition.id ? { ...step, completed: true } : step\n          ),\n          progress: ((index + 1) / loadingConditions.length) * 100,\n        }));\n        return true;\n      }\n    });\n\n    // Wait for all conditions to complete\n    const results = await Promise.all(checkPromises);\n    const allCompleted = results.every((result) => result);\n\n    // Complete loading with smooth fade-out\n    if (allCompleted) {\n      await new Promise((resolve) => setTimeout(resolve, FADE_OUT_DELAY));\n\n      setState((prev) => ({\n        ...prev,\n        isInitialLoading: false,\n        progress: 100,\n        currentStep: \"Ready\",\n      }));\n    }\n  }, [loadingConditions]);\n\n  // Start loading sequence on mount\n  useEffect(() => {\n    checkLoadingSteps();\n  }, [checkLoadingSteps]);\n\n  const setSuspenseLoading = useCallback((loading: boolean) => {\n    setState((prev) => ({ ...prev, isSuspenseLoading: loading }));\n  }, []);\n\n  // Force complete loading (emergency override)\n  const forceComplete = useCallback(() => {\n    setState((prev) => ({\n      ...prev,\n      isInitialLoading: false,\n      progress: 100,\n      currentStep: \"Ready\",\n    }));\n  }, []);\n\n  // Restart loading sequence\n  const restart = useCallback(() => {\n    setState({\n      isInitialLoading: true,\n      progress: 0,\n      currentStep: \"\",\n      steps: [],\n      isSuspenseLoading: false,\n    });\n    checkLoadingSteps();\n  }, [checkLoadingSteps]);\n\n  // Set Suspense loading state\n  const setSuspenseLoading = useCallback((loading: boolean) => {\n    setState(prev => ({ ...prev, isSuspenseLoading: loading }));\n  }, []);\n\n  // Computed property: overall loading state\n  const isOverallLoading = state.isInitialLoading || state.isSuspenseLoading;\n\n  return {\n    ...state,\n    isOverallLoading,\n    forceComplete,\n    restart,\n    setSuspenseLoading,\n  };\n}\n"],"version":3}