0346e68143ad1482d7b56b905d07968b
"use strict";
/**
 * Production Configuration Tests
 *
 * Comprehensive tests for production configuration utilities.
 */
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock performance monitor
jest.mock('../performance-monitor', function () { return ({
    performanceMonitor: {
        addMetric: jest.fn(),
        getMetricsByName: jest.fn(),
    },
}); });
var production_config_1 = require("./production.config");
// Mock process.env
var originalEnv = process.env;
describe('Production Configuration', function () {
    var performanceMonitor;
    beforeEach(function () { return __awaiter(void 0, void 0, void 0, function () {
        var mockPerformanceMonitor;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    jest.clearAllMocks();
                    jest.spyOn(performance, 'now').mockReturnValue(1000);
                    process.env = __assign({}, originalEnv);
                    return [4 /*yield*/, Promise.resolve().then(function () { return __importStar(require('../performance-monitor')); })];
                case 1:
                    mockPerformanceMonitor = (_a.sent()).performanceMonitor;
                    performanceMonitor = mockPerformanceMonitor;
                    return [2 /*return*/];
            }
        });
    }); });
    afterEach(function () {
        process.env = originalEnv;
    });
    describe('getProductionConfig', function () {
        it('should return production config for production environment', function () {
            Object.defineProperty(process.env, 'NODE_ENV', {
                value: 'production',
                writable: true,
                configurable: true,
            });
            var result = (0, production_config_1.getProductionConfig)();
            expect(result.compression).toBe(true);
            expect(result.minification).toBe(true);
            expect(result.treeShaking).toBe(true);
            expect(result.codeSplitting).toBe(true);
            expect(result.bundleAnalyzer).toBe(false);
            expect(result.sourceMaps).toBe(false);
            expect(performanceMonitor.addMetric).toHaveBeenCalledWith(expect.objectContaining({
                name: 'production_config_generation',
                value: 0,
                rating: 'good',
            }));
        });
        it('should return development config for development environment', function () {
            Object.defineProperty(process.env, 'NODE_ENV', {
                value: 'development',
                writable: true,
                configurable: true,
            });
            var result = (0, production_config_1.getProductionConfig)();
            expect(result.bundleAnalyzer).toBe(true);
            expect(result.sourceMaps).toBe(true);
        });
    });
    describe('generateNextJSConfig', function () {
        it('should generate Next.js config with default settings', function () {
            var result = (0, production_config_1.generateNextJSConfig)();
            expect(result.reactStrictMode).toBe(true);
            expect(result.poweredByHeader).toBe(false);
            expect(result.compress).toBe(true);
            expect(result.images).toBeDefined();
            expect(result.images.formats).toContain('image/webp');
            expect(result.images.formats).toContain('image/avif');
            expect(performanceMonitor.addMetric).toHaveBeenCalledWith(expect.objectContaining({
                name: 'nextjs_config_generation',
                value: 0,
                rating: 'good',
            }));
        });
        it('should generate Next.js config with custom settings', function () {
            var config = {
                compression: false,
                minification: false,
                bundleAnalyzer: true,
                sourceMaps: true,
            };
            var result = (0, production_config_1.generateNextJSConfig)(config);
            expect(result.compress).toBe(false);
            expect(result.bundleAnalyzer).toBeDefined();
            expect(result.productionBrowserSourceMaps).toBe(true);
        });
    });
    describe('generateWebpackConfig', function () {
        it('should generate webpack config with default settings', function () {
            var result = (0, production_config_1.generateWebpackConfig)();
            expect(result.optimization.minimize).toBe(true);
            expect(result.optimization.splitChunks).toBeDefined();
            expect(result.optimization.splitChunks.chunks).toBe('all');
            expect(result.performance).toBeDefined();
            expect(result.performance.hints).toBe('warning');
            expect(performanceMonitor.addMetric).toHaveBeenCalledWith(expect.objectContaining({
                name: 'webpack_config_generation',
                value: 0,
                rating: 'good',
            }));
        });
        it('should generate webpack config with custom settings', function () {
            var config = {
                minification: false,
                codeSplitting: false,
                treeShaking: false,
            };
            var result = (0, production_config_1.generateWebpackConfig)(config);
            expect(result.optimization.minimize).toBe(false);
            expect(result.optimization.splitChunks).toBe(false);
            expect(result.optimization.usedExports).toBeUndefined();
        });
        it('should enable tree shaking when configured', function () {
            var config = {
                treeShaking: true,
            };
            var result = (0, production_config_1.generateWebpackConfig)(config);
            expect(result.optimization.usedExports).toBe(true);
            expect(result.optimization.sideEffects).toBe(false);
        });
    });
    describe('generateEnvironmentConfig', function () {
        it('should generate development environment config', function () {
            var result = (0, production_config_1.generateEnvironmentConfig)('development');
            expect(result.NODE_ENV).toBe('development');
            expect(result.NEXT_PUBLIC_APP_ENV).toBe('development');
            expect(result.NEXT_PUBLIC_DEBUG).toBe('true');
            expect(result.NEXT_PUBLIC_ANALYTICS).toBe('false');
            expect(performanceMonitor.addMetric).toHaveBeenCalledWith(expect.objectContaining({
                name: 'environment_config_generation',
                value: 0,
                rating: 'good',
            }));
        });
        it('should generate production environment config', function () {
            var result = (0, production_config_1.generateEnvironmentConfig)('production');
            expect(result.NODE_ENV).toBe('production');
            expect(result.NEXT_PUBLIC_APP_ENV).toBe('production');
            expect(result.NEXT_PUBLIC_DEBUG).toBe('false');
            expect(result.NEXT_PUBLIC_ANALYTICS).toBe('true');
        });
        it('should generate test environment config', function () {
            var result = (0, production_config_1.generateEnvironmentConfig)('test');
            expect(result.NODE_ENV).toBe('test');
            expect(result.NEXT_PUBLIC_APP_ENV).toBe('test');
            expect(result.NEXT_PUBLIC_DEBUG).toBe('false');
            expect(result.NEXT_PUBLIC_ANALYTICS).toBe('false');
        });
        it('should handle unknown environment', function () {
            var result = (0, production_config_1.generateEnvironmentConfig)('unknown');
            expect(result.NODE_ENV).toBe('unknown');
            expect(result.NEXT_PUBLIC_APP_ENV).toBe('unknown');
        });
    });
    describe('validateProductionConfig', function () {
        it('should validate correct production config', function () {
            var config = {
                compression: true,
                minification: true,
                treeShaking: true,
                codeSplitting: true,
                bundleAnalyzer: false,
                sourceMaps: false,
            };
            var result = (0, production_config_1.validateProductionConfig)(config);
            expect(result.isValid).toBe(true);
            expect(result.errors).toHaveLength(0);
            expect(performanceMonitor.addMetric).toHaveBeenCalledWith(expect.objectContaining({
                name: 'production_config_validation',
                value: 0,
                rating: 'good',
            }));
        });
        it('should validate empty config', function () {
            var result = (0, production_config_1.validateProductionConfig)({});
            expect(result.isValid).toBe(true);
            expect(result.errors).toHaveLength(0);
        });
        it('should detect invalid compression type', function () {
            var config = {
                compression: 'true',
            };
            var result = (0, production_config_1.validateProductionConfig)(config);
            expect(result.isValid).toBe(false);
            expect(result.errors).toContain('compression must be a boolean');
        });
        it('should detect invalid minification type', function () {
            var config = {
                minification: 123,
            };
            var result = (0, production_config_1.validateProductionConfig)(config);
            expect(result.isValid).toBe(false);
            expect(result.errors).toContain('minification must be a boolean');
        });
        it('should detect multiple validation errors', function () {
            var config = {
                compression: 'true',
                minification: 123,
                treeShaking: 'false',
            };
            var result = (0, production_config_1.validateProductionConfig)(config);
            expect(result.isValid).toBe(false);
            expect(result.errors).toHaveLength(3);
            expect(result.errors).toContain('compression must be a boolean');
            expect(result.errors).toContain('minification must be a boolean');
            expect(result.errors).toContain('treeShaking must be a boolean');
        });
    });
    describe('getProductionMetrics', function () {
        it('should return production metrics', function () {
            var mockMetrics = [
                { name: 'production_config_generation', value: 10 },
                { name: 'nextjs_config_generation', value: 5 },
            ];
            performanceMonitor.getMetricsByName.mockImplementation(function (name) {
                return mockMetrics.filter(function (metric) { return metric.name === name; });
            });
            var result = (0, production_config_1.getProductionMetrics)();
            expect(result).toHaveLength(2);
            expect(performanceMonitor.getMetricsByName).toHaveBeenCalledWith('production_config_generation');
            expect(performanceMonitor.getMetricsByName).toHaveBeenCalledWith('nextjs_config_generation');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2dhbXphcmFtYXphbm92L0Rlc2t0b3AvZnVtby9zcmMvaW5mcmFzdHJ1Y3R1cmUvcGVyZm9ybWFuY2UvbGliL3Byb2R1Y3Rpb24tY29uZmlnL3Byb2R1Y3Rpb24uY29uZmlnLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFVSCwyQkFBMkI7QUFDM0IsSUFBSSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxjQUFNLE9BQUEsQ0FBQztJQUN6QyxrQkFBa0IsRUFBRTtRQUNsQixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNwQixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQzVCO0NBQ0YsQ0FBQyxFQUx3QyxDQUt4QyxDQUFDLENBQUM7QUFkSix5REFPNkI7QUFTN0IsbUJBQW1CO0FBQ25CLElBQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7QUFFaEMsUUFBUSxDQUFDLDBCQUEwQixFQUFFO0lBQ25DLElBQUksa0JBQXVCLENBQUM7SUFFNUIsVUFBVSxDQUFDOzs7OztvQkFDVCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7b0JBQ3JCLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDckQsT0FBTyxDQUFDLEdBQUcsZ0JBQVEsV0FBVyxDQUFFLENBQUM7b0JBRXNCLHNGQUFhLHdCQUF3QixRQUFDOztvQkFBakUsc0JBQXNCLEdBQUssQ0FBQSxTQUFzQyxDQUFBLG1CQUEzQztvQkFDbEQsa0JBQWtCLEdBQUcsc0JBQXNCLENBQUM7Ozs7U0FDN0MsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDO1FBQ1IsT0FBTyxDQUFDLEdBQUcsR0FBRyxXQUFXLENBQUM7SUFDNUIsQ0FBQyxDQUFDLENB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Q0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsc0JBQXNCLEVBQUU7UUFDL0IsRUFBRSxDQUFDLGtDQUFrQyxFQUFFO1lBQ3JDLElBQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFFLElBQUksRUFBRSw4QkFBOEIsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFO2dCQUNuRCxFQUFFLElBQUksRUFBRSwwQkFBMEIsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO2FBQy9DLENBQUM7WUFFRCxrQkFBa0IsQ0FBQyxnQkFBOEIsQ0FBQyxrQkFBa0IsQ0FBQyxVQUFDLElBQUk7Z0JBQ3pFLE9BQU8sV0FBVyxDQUFDLE1BQU0sQ0FBQyxVQUFDLE1BQU0sSUFBSyxPQUFBLE1BQU0sQ0FBQyxJQUFJLEtBQUssSUFBSSxFQUFwQixDQUFvQixDQUFDLENBQUM7WUFDOUQsQ0FBQyxDQUFDLENBQUM7WUFFSCxJQUFNLE1BQU0sR0FBRyxJQUFBLHdDQUFvQixHQUFFLENBQUM7WUFFdEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxvQkFBb0IsQ0FDOUQsOEJBQThCLENBQy9CLENBQUM7WUFDRixNQUFNLENBQUMsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1FBQy9GLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvZ2FtemFyYW1hemFub3YvRGVza3RvcC9mdW1vL3NyYy9pbmZyYXN0cnVjdHVyZS9wZXJmb3JtYW5jZS9saWIvcHJvZHVjdGlvbi1jb25maWcvcHJvZHVjdGlvbi5jb25maWcudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFByb2R1Y3Rpb24gQ29uZmlndXJhdGlvbiBUZXN0c1xuICpcbiAqIENvbXByZWhlbnNpdmUgdGVzdHMgZm9yIHByb2R1Y3Rpb24gY29uZmlndXJhdGlvbiB1dGlsaXRpZXMuXG4gKi9cblxuaW1wb3J0IHtcbiAgZ2VuZXJhdGVFbnZpcm9ubWVudENvbmZpZyxcbiAgZ2VuZXJhdGVOZXh0SlNDb25maWcsXG4gIGdlbmVyYXRlV2VicGFja0NvbmZpZyxcbiAgZ2V0UHJvZHVjdGlvbkNvbmZpZyxcbiAgZ2V0UHJvZHVjdGlvbk1ldHJpY3MsXG4gIHZhbGlkYXRlUHJvZHVjdGlvbkNvbmZpZyxcbn0gZnJvbSAnLi9wcm9kdWN0aW9uLmNvbmZpZyc7XG4vLyBNb2NrIHBlcmZvcm1hbmNlIG1vbml0b3Jcbmplc3QubW9jaygnLi4vcGVyZm9ybWFuY2UtbW9uaXRvcicsICgpID0+ICh7XG4gIHBlcmZvcm1hbmNlTW9uaXRvcjoge1xuICAgIGFkZE1ldHJpYzogamVzdC5mbigpLFxuICAgIGdldE1ldHJpY3NCeU5hbWU6IGplc3QuZm4oKSxcbiAgfSxcbn0pKTtcblxuLy8gTW9jayBwcm9jZXNzLmVudlxuY29uc3Qgb3JpZ2luYWxFbnYgPSBwcm9jZXNzLmVudjtcblxuZGVzY3JpYmUoJ1Byb2R1Y3Rpb24gQ29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgbGV0IHBlcmZvcm1hbmNlTW9uaXRvcjogYW55O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIGplc3Quc3B5T24ocGVyZm9ybWFuY2UsICdub3cnKS5tb2NrUmV0dXJuVmFsdWUoMTAwMCk7XG4gICAgcHJvY2Vzcy5lbnYgPSB7IC4uLm9yaWdpbmFsRW52IH07XG4gICAgLy8gR2V0IHRoZSBtb2NrZWQgcGVyZm9ybWFuY2UgbW9uaXRvclxuICAgIGNvbnN0IHsgcGVyZm9ybWFuY2VNb25pdG9yOiBtb2NrUGVyZm9ybWFuY2VNb25pdG9yIH0gPSBhd2FpdCBpbXBvcnQoJy4uL3BlcmZvcm1hbmNlLW1vbml0b3InKTtcbiAgICBwZXJmb3JtYW5jZU1vbml0b3IgPSBtb2NrUGVyZm9ybWFuY2VNb25pdG9yO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIHByb2Nlc3MuZW52ID0gb3JpZ2luYWxFbnY7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQcm9kdWN0aW9uQ29uZmlnJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHByb2R1Y3Rpb24gY29uZmlnIGZvciBwcm9kdWN0aW9uIGVudmlyb25tZW50JywgKCkgPT4ge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb2Nlc3MuZW52LCAnTk9ERV9FTlYnLCB7XG4gICAgICAgIHZhbHVlOiAncHJvZHVjdGlvbicsXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZ2V0UHJvZHVjdGlvbkNvbmZpZygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmNvbXByZXNzaW9uKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5taW5pZmljYXRpb24pLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnRyZWVTaGFraW5nKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb2RlU3BsaXR0aW5nKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5idW5kbGVBbmFseXplcikudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnNvdXJjZU1hcHMpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHBlcmZvcm1hbmNlTW9uaXRvci5hZGRNZXRyaWMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgbmFtZTogJ3Byb2R1Y3Rpb25fY29uZmlnX2dlbmVyYXRpb24nLFxuICAgICAgICAgIHZhbHVlOiAwLFxuICAgICAgICAgIHJhdGluZzogJ2dvb2QnLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGRldmVsb3BtZW50IGNvbmZpZyBmb3IgZGV2ZWxvcG1lbnQgZW52aXJvbm1lbnQnLCAoKSA9PiB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvY2Vzcy5lbnYsICdOT0RFX0VOVicsIHtcbiAgICAgICAgdmFsdWU6ICdkZXZlbG9wbWVudCcsXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZ2V0UHJvZHVjdGlvbkNvbmZpZygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmJ1bmRsZUFuYWx5emVyKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zb3VyY2VNYXBzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2VuZXJhdGVOZXh0SlNDb25maWcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBOZXh0LmpzIGNvbmZpZyB3aXRoIGRlZmF1bHQgc2V0dGluZ3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBnZW5lcmF0ZU5leHRKU0NvbmZpZygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnJlYWN0U3RyaWN0TW9kZSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucG93ZXJlZEJ5SGVhZGVyKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY29tcHJlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmltYWdlcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCgocmVzdWx0LmltYWdlcyBhcyBhbnkpLmZvcm1hdHMpLnRvQ29udGFpbignaW1hZ2Uvd2VicCcpO1xuICAgICAgZXhwZWN0KChyZXN1bHQuaW1hZ2VzIGFzIGFueSkuZm9ybWF0cykudG9Db250YWluKCdpbWFnZS9hdmlmJyk7XG4gICAgICBleHBlY3QocGVyZm9ybWFuY2VNb25pdG9yLmFkZE1ldHJpYykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBuYW1lOiAnbmV4dGpzX2NvbmZpZ19nZW5lcmF0aW9uJyxcbiAgICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgICByYXRpbmc6ICdnb29kJyxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIE5leHQuanMgY29uZmlnIHdpdGggY3VzdG9tIHNldHRpbmdzJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBjb21wcmVzc2lvbjogZmFsc2UsXG4gICAgICAgIG1pbmlmaWNhdGlvbjogZmFsc2UsXG4gICAgICAgIGJ1bmRsZUFuYWx5emVyOiB0cnVlLFxuICAgICAgICBzb3VyY2VNYXBzOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZ2VuZXJhdGVOZXh0SlNDb25maWcoY29uZmlnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5jb21wcmVzcykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmJ1bmRsZUFuYWx5emVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wcm9kdWN0aW9uQnJvd3NlclNvdXJjZU1hcHMpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZW5lcmF0ZVdlYnBhY2tDb25maWcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSB3ZWJwYWNrIGNvbmZpZyB3aXRoIGRlZmF1bHQgc2V0dGluZ3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBnZW5lcmF0ZVdlYnBhY2tDb25maWcoKTtcblxuICAgICAgZXhwZWN0KChyZXN1bHQub3B0aW1pemF0aW9uIGFzIGFueSkubWluaW1pemUpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoKHJlc3VsdC5vcHRpbWl6YXRpb24gYXMgYW55KS5zcGxpdENodW5rcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCgocmVzdWx0Lm9wdGltaXphdGlvbiBhcyBhbnkpLnNwbGl0Q2h1bmtzLmNodW5rcykudG9CZSgnYWxsJyk7XG4gICAgICBleHBlY3QocmVzdWx0LnBlcmZvcm1hbmNlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KChyZXN1bHQucGVyZm9ybWFuY2UgYXMgYW55KS5oaW50cykudG9CZSgnd2FybmluZycpO1xuICAgICAgZXhwZWN0KHBlcmZvcm1hbmNlTW9uaXRvci5hZGRNZXRyaWMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgbmFtZTogJ3dlYnBhY2tfY29uZmlnX2dlbmVyYXRpb24nLFxuICAgICAgICAgIHZhbHVlOiAwLFxuICAgICAgICAgIHJhdGluZzogJ2dvb2QnLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgd2VicGFjayBjb25maWcgd2l0aCBjdXN0b20gc2V0dGluZ3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIG1pbmlmaWNhdGlvbjogZmFsc2UsXG4gICAgICAgIGNvZGVTcGxpdHRpbmc6IGZhbHNlLFxuICAgICAgICB0cmVlU2hha2luZzogZmFsc2UsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBnZW5lcmF0ZVdlYnBhY2tDb25maWcoY29uZmlnKTtcblxuICAgICAgZXhwZWN0KChyZXN1bHQub3B0aW1pemF0aW9uIGFzIGFueSkubWluaW1pemUpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KChyZXN1bHQub3B0aW1pemF0aW9uIGFzIGFueSkuc3BsaXRDaHVua3MpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KChyZXN1bHQub3B0aW1pemF0aW9uIGFzIGFueSkudXNlZEV4cG9ydHMpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW5hYmxlIHRyZWUgc2hha2luZyB3aGVuIGNvbmZpZ3VyZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIHRyZWVTaGFraW5nOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZ2VuZXJhdGVXZWJwYWNrQ29uZmlnKGNvbmZpZyk7XG5cbiAgICAgIGV4cGVjdCgocmVzdWx0Lm9wdGltaXphdGlvbiBhcyBhbnkpLnVzZWRFeHBvcnRzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KChyZXN1bHQub3B0aW1pemF0aW9uIGFzIGFueSkuc2lkZUVmZmVjdHMpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2VuZXJhdGVFbnZpcm9ubWVudENvbmZpZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGRldmVsb3BtZW50IGVudmlyb25tZW50IGNvbmZpZycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGdlbmVyYXRlRW52aXJvbm1lbnRDb25maWcoJ2RldmVsb3BtZW50Jyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuTk9ERV9FTlYpLnRvQmUoJ2RldmVsb3BtZW50Jyk7XG4gICAgICBleHBlY3QocmVzdWx0Lk5FWFRfUFVCTElDX0FQUF9FTlYpLnRvQmUoJ2RldmVsb3BtZW50Jyk7XG4gICAgICBleHBlY3QocmVzdWx0Lk5FWFRfUFVCTElDX0RFQlVHKS50b0JlKCd0cnVlJyk7XG4gICAgICBleHBlY3QocmVzdWx0Lk5FWFRfUFVCTElDX0FOQUxZVElDUykudG9CZSgnZmFsc2UnKTtcbiAgICAgIGV4cGVjdChwZXJmb3JtYW5jZU1vbml0b3IuYWRkTWV0cmljKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIG5hbWU6ICdlbnZpcm9ubWVudF9jb25maWdfZ2VuZXJhdGlvbicsXG4gICAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgICAgcmF0aW5nOiAnZ29vZCcsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBwcm9kdWN0aW9uIGVudmlyb25tZW50IGNvbmZpZycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGdlbmVyYXRlRW52aXJvbm1lbnRDb25maWcoJ3Byb2R1Y3Rpb24nKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5OT0RFX0VOVikudG9CZSgncHJvZHVjdGlvbicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5ORVhUX1BVQkxJQ19BUFBfRU5WKS50b0JlKCdwcm9kdWN0aW9uJyk7XG4gICAgICBleHBlY3QocmVzdWx0Lk5FWFRfUFVCTElDX0RFQlVHKS50b0JlKCdmYWxzZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5ORVhUX1BVQkxJQ19BTkFMWVRJQ1MpLnRvQmUoJ3RydWUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgdGVzdCBlbnZpcm9ubWVudCBjb25maWcnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBnZW5lcmF0ZUVudmlyb25tZW50Q29uZmlnKCd0ZXN0Jyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuTk9ERV9FTlYpLnRvQmUoJ3Rlc3QnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuTkVYVF9QVUJMSUNfQVBQX0VOVikudG9CZSgndGVzdCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5ORVhUX1BVQkxJQ19ERUJVRykudG9CZSgnZmFsc2UnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuTkVYVF9QVUJMSUNfQU5BTFlUSUNTKS50b0JlKCdmYWxzZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdW5rbm93biBlbnZpcm9ubWVudCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGdlbmVyYXRlRW52aXJvbm1lbnRDb25maWcoJ3Vua25vd24nIGFzIGFueSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuTk9ERV9FTlYpLnRvQmUoJ3Vua25vd24nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuTkVYVF9QVUJMSUNfQVBQX0VOVikudG9CZSgndW5rbm93bicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVQcm9kdWN0aW9uQ29uZmlnJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgY29ycmVjdCBwcm9kdWN0aW9uIGNvbmZpZycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgY29tcHJlc3Npb246IHRydWUsXG4gICAgICAgIG1pbmlmaWNhdGlvbjogdHJ1ZSxcbiAgICAgICAgdHJlZVNoYWtpbmc6IHRydWUsXG4gICAgICAgIGNvZGVTcGxpdHRpbmc6IHRydWUsXG4gICAgICAgIGJ1bmRsZUFuYWx5emVyOiBmYWxzZSxcbiAgICAgICAgc291cmNlTWFwczogZmFsc2UsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZVByb2R1Y3Rpb25Db25maWcoY29uZmlnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChwZXJmb3JtYW5jZU1vbml0b3IuYWRkTWV0cmljKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIG5hbWU6ICdwcm9kdWN0aW9uX2NvbmZpZ192YWxpZGF0aW9uJyxcbiAgICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgICByYXRpbmc6ICdnb29kJyxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGVtcHR5IGNvbmZpZycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlUHJvZHVjdGlvbkNvbmZpZyh7fSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRldGVjdCBpbnZhbGlkIGNvbXByZXNzaW9uIHR5cGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgIGNvbXByZXNzaW9uOiAndHJ1ZScgYXMgYW55LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVQcm9kdWN0aW9uQ29uZmlnKGNvbmZpZyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9Db250YWluKCdjb21wcmVzc2lvbiBtdXN0IGJlIGEgYm9vbGVhbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgaW52YWxpZCBtaW5pZmljYXRpb24gdHlwZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgbWluaWZpY2F0aW9uOiAxMjMgYXMgYW55LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVQcm9kdWN0aW9uQ29uZmlnKGNvbmZpZyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9Db250YWluKCdtaW5pZmljYXRpb24gbXVzdCBiZSBhIGJvb2xlYW4nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IG11bHRpcGxlIHZhbGlkYXRpb24gZXJyb3JzJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBjb21wcmVzc2lvbjogJ3RydWUnIGFzIGFueSxcbiAgICAgICAgbWluaWZpY2F0aW9uOiAxMjMgYXMgYW55LFxuICAgICAgICB0cmVlU2hha2luZzogJ2ZhbHNlJyBhcyBhbnksXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZVByb2R1Y3Rpb25Db25maWcoY29uZmlnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9Db250YWluKCdjb21wcmVzc2lvbiBtdXN0IGJlIGEgYm9vbGVhbicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnMpLnRvQ29udGFpbignbWluaWZpY2F0aW9uIG11c3QgYmUgYSBib29sZWFuJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9Db250YWluKCd0cmVlU2hha2luZyBtdXN0IGJlIGEgYm9vbGVhbicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UHJvZHVjdGlvbk1ldHJpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvZHVjdGlvbiBtZXRyaWNzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja01ldHJpY3MgPSBbXG4gICAgICAgIHsgbmFtZTogJ3Byb2R1Y3Rpb25fY29uZmlnX2dlbmVyYXRpb24nLCB2YWx1ZTogMTAgfSxcbiAgICAgICAgeyBuYW1lOiAnbmV4dGpzX2NvbmZpZ19nZW5lcmF0aW9uJywgdmFsdWU6IDUgfSxcbiAgICAgIF07XG5cbiAgICAgIChwZXJmb3JtYW5jZU1vbml0b3IuZ2V0TWV0cmljc0J5TmFtZSBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbigobmFtZSkgPT4ge1xuICAgICAgICByZXR1cm4gbW9ja01ldHJpY3MuZmlsdGVyKChtZXRyaWMpID0+IG1ldHJpYy5uYW1lID09PSBuYW1lKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBnZXRQcm9kdWN0aW9uTWV0cmljcygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocGVyZm9ybWFuY2VNb25pdG9yLmdldE1ldHJpY3NCeU5hbWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAncHJvZHVjdGlvbl9jb25maWdfZ2VuZXJhdGlvbidcbiAgICAgICk7XG4gICAgICBleHBlY3QocGVyZm9ybWFuY2VNb25pdG9yLmdldE1ldHJpY3NCeU5hbWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCduZXh0anNfY29uZmlnX2dlbmVyYXRpb24nKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==