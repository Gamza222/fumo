{"file":"/Users/gamzaramazanov/Desktop/fumo/src/infrastructure/security/lib/security-config/security.config.ts","mappings":"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","names":[],"sources":["/Users/gamzaramazanov/Desktop/fumo/src/infrastructure/security/lib/security-config/security.config.ts"],"sourcesContent":["/**\n * Security Configuration\n *\n * Comprehensive security settings for enterprise applications.\n * Includes CSP, security headers, authentication, and authorization.\n */\n\nimport { Environment } from '../../../../../config/env';\nimport type { SecurityConfig } from '../../types/security.types';\n\n// ============================================================================\n// ENVIRONMENT-SPECIFIC SECURITY CONFIGURATION\n// ============================================================================\n\nconst getSecurityConfig = (): SecurityConfig => {\n  const isProduction = process.env.NODE_ENV === Environment.Production;\n  const isDevelopment = process.env.NODE_ENV === Environment.Development;\n\n  // Base CSP policy\n  const baseCSP = [\n    \"default-src 'self'\",\n    \"script-src 'self' 'unsafe-inline' 'unsafe-eval'\", // Next.js requires unsafe-eval in dev\n    \"style-src 'self' 'unsafe-inline'\",\n    \"img-src 'self' data: blob: https:\",\n    \"font-src 'self' data:\",\n    \"connect-src 'self' ws: wss: https:\",\n    \"media-src 'self'\",\n    \"object-src 'none'\",\n    \"base-uri 'self'\",\n    \"form-action 'self'\",\n    \"frame-ancestors 'none'\",\n  ];\n\n  // Add development-specific CSP\n  if (isDevelopment) {\n    baseCSP.push(\"'unsafe-eval'\"); // Required for Next.js dev mode\n  }\n\n  // Add production-specific CSP\n  if (isProduction) {\n    // Remove unsafe-inline and unsafe-eval in production\n    const productionCSP = baseCSP.map((directive) => {\n      if (directive.includes('unsafe-inline') || directive.includes('unsafe-eval')) {\n        return directive.replace(/ 'unsafe-inline'|'unsafe-eval'/g, '');\n      }\n      return directive;\n    });\n    baseCSP.splice(0, baseCSP.length, ...productionCSP);\n  }\n\n  return {\n    headers: {\n      'Content-Security-Policy': baseCSP.join('; '),\n      'X-Frame-Options': 'DENY',\n      'X-Content-Type-Options': 'nosniff',\n      'Referrer-Policy': 'strict-origin-when-cross-origin',\n      'Permissions-Policy': 'camera=(), microphone=(), geolocation=(), payment=()',\n      'X-XSS-Protection': '1; mode=block',\n      ...(isProduction && {\n        'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload',\n      }),\n    },\n    cors: {\n      origin: isDevelopment\n        ? ['http://localhost:3000', 'http://localhost:3001']\n        : process.env.NEXT_PUBLIC_APP_URL || 'https://yourdomain.com',\n      credentials: true,\n      methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],\n      allowedHeaders: [\n        'Content-Type',\n        'Authorization',\n        'X-Requested-With',\n        'Accept',\n        'Origin',\n        'Access-Control-Request-Method',\n        'Access-Control-Request-Headers',\n      ],\n      exposedHeaders: ['X-Total-Count', 'X-Page-Count'],\n      maxAge: 86400, // 24 hours\n    },\n    auth: {\n      jwtSecret: process.env.JWT_SECRET || 'your-super-secret-jwt-key-change-in-production',\n      jwtExpiresIn: process.env.JWT_EXPIRES_IN || '15m',\n      refreshTokenExpiresIn: process.env.REFRESH_TOKEN_EXPIRES_IN || '7d',\n      passwordMinLength: parseInt(process.env.PASSWORD_MIN_LENGTH || '8', 10),\n      passwordRequireSpecialChars: process.env.PASSWORD_REQUIRE_SPECIAL_CHARS === 'true',\n      passwordRequireNumbers: process.env.PASSWORD_REQUIRE_NUMBERS === 'true',\n      passwordRequireUppercase: process.env.PASSWORD_REQUIRE_UPPERCASE === 'true',\n      sessionTimeout: parseInt(process.env.SESSION_TIMEOUT || '3600000', 10), // 1 hour\n    },\n    rateLimit: {\n      windowMs: parseInt(process.env.RATE_LIMIT_WINDOW_MS || '900000', 10), // 15 minutes\n      maxRequests: parseInt(process.env.RATE_LIMIT_MAX_REQUESTS || '100', 10),\n      skipSuccessfulRequests: process.env.RATE_LIMIT_SKIP_SUCCESS === 'true',\n      skipFailedRequests: process.env.RATE_LIMIT_SKIP_FAILED === 'false',\n    },\n  };\n};\n\nexport const securityConfig = getSecurityConfig();\n\n// ============================================================================\n// SECURITY UTILITIES\n// ============================================================================\n\n/**\n * Validate password strength based on security configuration\n */\nexport const validatePassword = (password: string): { isValid: boolean; errors: string[] } => {\n  const config = securityConfig.auth;\n  const errors: string[] = [];\n\n  if (password.length < config.passwordMinLength) {\n    errors.push(`Password must be at least ${config.passwordMinLength} characters long`);\n  }\n\n  if (config.passwordRequireSpecialChars && !/[!@#$%^&*(),.?\":{}|<>]/.test(password)) {\n    errors.push('Password must contain at least one special character');\n  }\n\n  if (config.passwordRequireNumbers && !/\\d/.test(password)) {\n    errors.push('Password must contain at least one number');\n  }\n\n  if (config.passwordRequireUppercase && !/[A-Z]/.test(password)) {\n    errors.push('Password must contain at least one uppercase letter');\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors,\n  };\n};\n\n/**\n * Generate secure random string for tokens\n */\nexport const generateSecureToken = (length: number = 32): string => {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let result = '';\n  const array = new Uint8Array(length);\n  crypto.getRandomValues(array);\n\n  for (let i = 0; i < length; i++) {\n    result += chars[(array[i] || 0) % chars.length];\n  }\n\n  return result;\n};\n\n/**\n * Check if request origin is allowed\n */\nexport const isOriginAllowed = (origin: string): boolean => {\n  const config = securityConfig.cors;\n  const allowedOrigins = Array.isArray(config.origin) ? config.origin : [config.origin];\n  return allowedOrigins.includes(origin);\n};\n"],"version":3}