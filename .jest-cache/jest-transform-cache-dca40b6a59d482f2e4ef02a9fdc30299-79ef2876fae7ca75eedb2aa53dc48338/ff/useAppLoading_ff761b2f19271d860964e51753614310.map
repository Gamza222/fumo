{"file":"/Users/gamzaramazanov/Desktop/fumo/src/infrastructure/providers/app-loading/hooks/useAppLoading/useAppLoading.ts","mappings":"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","names":[],"sources":["/Users/gamzaramazanov/Desktop/fumo/src/infrastructure/providers/app-loading/hooks/useAppLoading/useAppLoading.ts"],"sourcesContent":["/**\n * useAppLoading Hook\n *\n * Manages initial app loading state and progress.\n * Checks multiple conditions sequentially with minimum display time.\n * Provides smooth loading experience with progress tracking.\n */\n\n'use client';\n\nimport { useState, useEffect, useCallback, useMemo } from 'react';\nimport {\n  AppLoadingConditionId,\n  AppLoadingConditionName,\n  AppLoadingPriority,\n} from '../../model/enums/enums';\nimport {\n  TIMEOUTS,\n  PRIORITIES,\n  MINIMUM_DISPLAY_TIME,\n  SELECTORS,\n  DOCUMENT_COMPLETE,\n  DEFAULT_TIMEOUT,\n} from '../../model/constants/constants';\nimport { LoadingCondition, LoadingStep, UseAppLoadingReturn } from '../../model/types/types';\n\n// ============================================================================\n// CONDITION CHECKS (Single Responsibility - Each checks one thing)\n// ============================================================================\n\nconst checkDOMReady = (): boolean => document.readyState === DOCUMENT_COMPLETE;\n\nconst checkCriticalCSS = (): boolean => {\n  const criticalSheets = document.querySelectorAll(SELECTORS.CRITICAL_CSS);\n  return (\n    criticalSheets.length === 0 ||\n    Array.from(criticalSheets).every((sheet) => (sheet as HTMLLinkElement).sheet !== null)\n  );\n};\n\nconst checkThemeInitialized = (): boolean => {\n  return (\n    document.documentElement.hasAttribute(SELECTORS.THEME_ATTRIBUTE) ||\n    document.body.classList.contains(SELECTORS.THEME_CLASS) ||\n    document.documentElement.classList.contains(SELECTORS.THEME_APPLIED_CLASS)\n  );\n};\n\nconst checkCoreJavaScript = (): boolean => {\n  return typeof window !== 'undefined' && document.readyState === DOCUMENT_COMPLETE;\n};\n\nconst ensureMinimumDisplayTime = async (): Promise<void> => {\n  const startTime = performance.now();\n  const elapsedTime = performance.now() - startTime;\n  const remainingTime = Math.max(0, MINIMUM_DISPLAY_TIME - elapsedTime);\n\n  if (remainingTime > 0) {\n    await new Promise((resolve) => setTimeout(resolve, remainingTime));\n  }\n};\n\n// ============================================================================\n// CONDITIONS CONFIGURATION (Open/Closed - Easy to extend)\n// ============================================================================\n\nconst createLoadingConditions = (): LoadingCondition[] => [\n  {\n    id: AppLoadingConditionId.DOM_READY,\n    name: AppLoadingConditionName.PREPARING_APPLICATION,\n    priority: PRIORITIES[AppLoadingConditionId.DOM_READY],\n    check: checkDOMReady,\n    timeout: TIMEOUTS[AppLoadingConditionId.DOM_READY],\n  },\n  {\n    id: AppLoadingConditionId.CRITICAL_CSS,\n    name: AppLoadingConditionName.LOADING_STYLES,\n    priority: PRIORITIES[AppLoadingConditionId.CRITICAL_CSS],\n    check: checkCriticalCSS,\n    timeout: TIMEOUTS[AppLoadingConditionId.CRITICAL_CSS],\n  },\n  {\n    id: AppLoadingConditionId.THEME_INITIALIZED,\n    name: AppLoadingConditionName.APPLYING_THEME,\n    priority: PRIORITIES[AppLoadingConditionId.THEME_INITIALIZED],\n    check: checkThemeInitialized,\n    timeout: TIMEOUTS[AppLoadingConditionId.THEME_INITIALIZED],\n  },\n  {\n    id: AppLoadingConditionId.CORE_JAVASCRIPT,\n    name: AppLoadingConditionName.LOADING_CORE_FEATURES,\n    priority: PRIORITIES[AppLoadingConditionId.CORE_JAVASCRIPT],\n    check: checkCoreJavaScript,\n    timeout: TIMEOUTS[AppLoadingConditionId.CORE_JAVASCRIPT],\n  },\n];\n\n// ============================================================================\n// MAIN HOOK (Orchestrates everything)\n// ============================================================================\n\nexport function useAppLoading(): UseAppLoadingReturn {\n  const [state, setState] = useState({\n    isInitialLoading: true,\n    progress: 0,\n    currentStep: '',\n    steps: [] as LoadingStep[],\n    isSuspenseLoading: false,\n  });\n\n  const loadingConditions = useMemo(() => createLoadingConditions(), []);\n\n  const checkLoadingSteps = useCallback(async () => {\n    const stepsWithStatus: LoadingStep[] = loadingConditions.map((condition) => ({\n      id: condition.id,\n      name: condition.name,\n      completed: false,\n      priority: condition.priority || AppLoadingPriority.LOWEST,\n    }));\n\n    setState((prev) => ({ ...prev, steps: stepsWithStatus }));\n\n    // Start continuous progress updates with requestAnimationFrame\n    const startTime = performance.now();\n    const totalExpectedTime = loadingConditions.length * MINIMUM_DISPLAY_TIME;\n\n    let animationFrameId: number;\n\n    const updateProgress = () => {\n      const elapsed = performance.now() - startTime;\n      const smoothProgress = Math.min((elapsed / totalExpectedTime) * 100, 100);\n      setState((prev) => ({ ...prev, progress: smoothProgress }));\n\n      if (smoothProgress < 100) {\n        animationFrameId = requestAnimationFrame(updateProgress);\n      }\n    };\n\n    // Start the animation\n    animationFrameId = requestAnimationFrame(updateProgress);\n\n    // Process conditions sequentially\n    for (let index = 0; index < loadingConditions.length; index++) {\n      const condition = loadingConditions[index] as LoadingCondition;\n\n      // Update current step\n      setState((prev) => ({\n        ...prev,\n        currentStep: condition.name,\n      }));\n\n      try {\n        const result = await Promise.race([\n          Promise.resolve(condition.check()),\n          new Promise<boolean>((_, reject) =>\n            setTimeout(() => reject(new Error('Timeout')), condition.timeout || DEFAULT_TIMEOUT)\n          ),\n        ]);\n\n        await ensureMinimumDisplayTime();\n\n        setState((prev) => ({\n          ...prev,\n          steps: prev.steps.map((step) =>\n            step.id === condition.id ? { ...step, completed: result } : step\n          ),\n        }));\n      } catch (error) {\n        await ensureMinimumDisplayTime();\n\n        setState((prev) => ({\n          ...prev,\n          steps: prev.steps.map((step) =>\n            step.id === condition.id ? { ...step, completed: true } : step\n          ),\n        }));\n      }\n    }\n\n    // Clean up animation frame and complete\n    if (animationFrameId) {\n      cancelAnimationFrame(animationFrameId);\n    }\n\n    setState((prev) => ({\n      ...prev,\n      isInitialLoading: false,\n      progress: 100,\n      currentStep: 'Ready',\n    }));\n  }, [loadingConditions]);\n\n  useEffect(() => {\n    void checkLoadingSteps();\n  }, [checkLoadingSteps]);\n\n  const forceComplete = useCallback(() => {\n    setState((prev) => ({\n      ...prev,\n      isInitialLoading: false,\n      progress: 100,\n      currentStep: 'Ready',\n    }));\n  }, []);\n\n  const restart = useCallback(() => {\n    setState({\n      isInitialLoading: true,\n      progress: 0,\n      currentStep: '',\n      steps: [],\n      isSuspenseLoading: false,\n    });\n    void checkLoadingSteps();\n  }, [checkLoadingSteps]);\n\n  const setSuspenseLoading = useCallback((loading: boolean) => {\n    setState((prev) => ({ ...prev, isSuspenseLoading: loading }));\n  }, []);\n\n  const isOverallLoading = state.isInitialLoading || state.isSuspenseLoading;\n\n  return {\n    ...state,\n    isOverallLoading,\n    forceComplete,\n    restart,\n    setSuspenseLoading,\n  };\n}\n"],"version":3}